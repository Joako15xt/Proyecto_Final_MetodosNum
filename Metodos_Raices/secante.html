<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Secante — e^{-x} - x = 0</title>
  <link rel="stylesheet" href="../estilos.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top" style="background:#6A0B1F; border:none;">
  <div class="container">
    <div class="navbar-header">
      <a class="navbar-brand" href="../raices.html" style="color:white; font-weight:bold;">Método de la Secante</a>
    </div>
    <ul class="nav navbar-nav navbar-right">
      <li><a style="color:white;">Humberto Joaquin Loza Fernandez</a></li>
      <li><a style="color:white;">CI: 12480310</a></li>
      <li><a style="color:white;">Lic. Brígida Carvajal Blanco</a></li>
      <li><a href="../raices.html" style="color:white; font-weight:bold; background:#FFD700; padding:8px 15px; border-radius:5px; margin:5px; display:inline-block; color:#6A0B1F !important;">← Volver a Raíces</a></li>
    </ul>
  </div>
</nav>

<div class="container" style="margin-top:90px;">

  <h1 class="titulo">Método de la Secante</h1>
  <p class="descripcion">
    El método de la secante permite aproximar la raíz de <code>f(x)=e^{-x}-x</code> utilizando una aproximación
    lineal sin necesidad de derivadas. Tomamos como referencia los valores iniciales mostrados en la imagen:
    <strong>x₀ = -1</strong> y <strong>x₁ = -1.5</strong>.
  </p>

  <div class="capsulas">
    <span class="capsula">x₀ = -1</span>
    <span class="capsula">x₁ = -1.5</span>
    <span class="capsula">Tolerancia = 0.00005</span>
  </div>

  <div class="card-metodo" style="margin-top:30px; cursor:default;">
    <h3>Tabla de iteraciones</h3>
    <p>
      Aplicamos la fórmula de la Secante:
      <br>
      <code>x(i+1) = x(i) - ( f(x(i)) * (x(i)-x(i-1)) ) / ( f(x(i-1)) - f(x(i)) )</code>
    </p>
    <button class="btn-metodo" onclick="secante()">Calcular Secante</button>
    <div id="tablaSec" style="margin-top:15px;"></div>
  </div>

  <div class="card-metodo" style="cursor:default;">
    <h3>Resultado aproximado</h3>
    <div id="resultadoSec"></div>
  </div>

  <div class="card-metodo" style="cursor:default;">
    <h3>Gráfica de la función y puntos del método</h3>
    <canvas id="graficaSec"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
function f(x){ return Math.exp(-x) - x; }

function secante(){
  let x0 = -1;
  let x1 = -1.5;
  const tol = 0.00005;
  let iter = 0;

  let html =
    "<table class='table table-bordered table-striped'>" +
    "<thead><tr><th>#</th><th>x0</th><th>x1</th><th>x2</th><th>f(x2)</th></tr></thead><tbody>";

  let puntosX = [], puntosY = [];

  while(true){
    let fx0 = f(x0);
    let fx1 = f(x1);
    
    // Evitar división por cero
    if(Math.abs(fx0 - fx1) < 1e-12){
      alert('División por cero en iteración ' + iter);
      break;
    }
    
    let x2 = x1 - fx1*(x1 - x0)/(fx0 - fx1);
    let fx2 = f(x2);

    html += `<tr>
               <td>${iter}</td>
               <td>${x0.toFixed(6)}</td>
               <td>${x1.toFixed(6)}</td>
               <td>${x2.toFixed(6)}</td>
               <td>${fx2.toFixed(10)}</td>
             </tr>`;

    puntosX.push(x2);
    puntosY.push(fx2);

    if(Math.abs(fx2) <= tol){
      document.getElementById('tablaSec').innerHTML = html + "</tbody></table>";

      document.getElementById('resultadoSec').innerHTML = `
        <p><strong>Raíz aproximada = </strong>${x2.toFixed(10)}</p>
        <p><strong>f(x2) = </strong>${fx2.toFixed(10)}</p>
        <p><strong>Iteraciones = </strong>${iter}</p>
      `;

      dibujarGrafica(puntosX, puntosY);
      return;
    }

    x0 = x1;
    x1 = x2;

    iter++;
    if(iter > 100){
      alert('Máximo de iteraciones alcanzado (100)');
      document.getElementById('tablaSec').innerHTML = html + "</tbody></table>";
      document.getElementById('resultadoSec').innerHTML = `<p><strong>Iteraciones agotadas sin convergencia</strong></p>`;
      dibujarGrafica(puntosX, puntosY);
      return;
    }
  }
}

function dibujarGrafica(px, py){
  const ctx = document.getElementById('graficaSec');
  
  // Limpiar gráfica anterior
  if(window.chartInstance){
    window.chartInstance.destroy();
  }
  
  const xs = [], ys = [];
  for(let x=-2; x<=2; x+=0.1){
    xs.push(x);
    ys.push(f(x));
  }

  const lineData = xs.map((x,i)=>({x:x, y:ys[i]}));
  const iterData = px.map((m,i)=>({x:m, y:py[i]}));

  window.chartInstance = new Chart(ctx,{
    type:'scatter',
    data:{
      datasets:[
        {
          label:'f(x)', 
          data:lineData, 
          borderColor:'green', 
          showLine:true, 
          fill:false, 
          tension:0.1, 
          borderWidth:2, 
          pointRadius:0
        },
        {
          label:'Iteraciones', 
          data:iterData, 
          borderColor:'red', 
          backgroundColor:'red', 
          pointRadius:7, 
          showLine:false
        }
      ]
    },
    options:{
      responsive:true,
      scales:{
        x:{ 
          type:'linear',
          position:'bottom',
          title:{display:true, text:'x'}
        },
        y:{ 
          title:{display:true, text:'f(x)'}
        }
      },
      plugins:{
        legend:{display:true, position:'top'}
      }
    }
  });
}
</script>

<footer>
  <p>&copy; 2025 Métodos Numéricos | Desarrollado por <a href="#">joako15xt</a> | Todos los derechos reservados</p>
</footer>
</body>
</html>
